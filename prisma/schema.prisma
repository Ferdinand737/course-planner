datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id    String @id @default(cuid())
  email String @unique

  isAdmin Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  password    Password?
  coursePlans CoursePlan[]
}

model Password {
  hash String

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique
}

enum DegreeType {
  BSc
  BA
}

model Degree {
  id String @id @default(cuid())

  degreeType      DegreeType
  specializations Specialization[] @relation("DegreeSpecializations")

  CoursePlan CoursePlan[]
}

enum SpecializationType {
  MAJOR
  MINOR
  HONOURS
}

model Specialization {
  id String @id @default(cuid())

  name String

  specializationType SpecializationType
  discipline         String

  requirements Requirement[]

  degree Degree[] @relation("DegreeSpecializations")
}

enum RequirementType {
  AT_LEAST
}

model Requirement {
  id              String          @id @default(cuid())
  constraintType  RequirementType @default(AT_LEAST)
  credits         Int
  year            Int
  programSpecific Boolean         @default(false)

  electiveType   Course? @relation(fields: [electiveTypeId], references: [id])
  electiveTypeId String?

  alternatives Course[] @relation("CourseRequirements")

  specialization   Specialization? @relation(fields: [specializationId], references: [id])
  specializationId String?
}

model CoursePlan {
  id        String   @id @default(cuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  numTerms  Int      @default(16)

  degree   Degree @relation(fields: [degreeId], references: [id])
  degreeId String

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String

  plannedCourses PlannedCourse[]
}

enum ElectiveType {
  ELEC
  CHOICE
}
model PlannedCourse {
  id   String @id @default(cuid())
  term Int

  isElective Boolean @default(false)
  electiveType ElectiveType?

  course   Course @relation(fields: [courseId], references: [id])
  courseId String

  alternativeCourses Course[] @relation("PlannedCourseAlternatives")

  coursePlan   CoursePlan @relation(fields: [coursePlanId], references: [id])
  coursePlanId String
}

enum Faculty {
  SCI
  ART
  OTHER
}

model Course {
  id          String  @id @default(cuid())
  code        String  @unique
  name        String
  description String?
  isElectivePlacholder  Boolean @default(false)// Special type of placeholder course

  winterTerm1 Boolean @default(false)
  winterTerm2 Boolean @default(false)
  summerTerm1 Boolean @default(false)
  summerTerm2 Boolean @default(false)

  durationTerms Int     @default(1)
  credits       Float   @default(3)
  isHonours     Boolean @default(false)

  faculty Faculty

  requirements Requirement[] @relation("CourseRequirements")

  plannedCourses PlannedCourse[]

  alternativeCourses PlannedCourse[] @relation("PlannedCourseAlternatives")

  equivalentCourses Course[] @relation("EquivalentCourses")
  equivalentTo      Course[] @relation("EquivalentCourses")

  coRequisiteCourses Course[] @relation("CoRequisites")
  coRequisiteOf      Course[] @relation("CoRequisites")

  excludedCourses Course[] @relation("ExcludedCourses")
  excludedBy      Course[] @relation("ExcludedCourses")

  preRequisites Json          @default("{}")
  requirement   Requirement[]
}
